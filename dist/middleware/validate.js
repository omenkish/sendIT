"use strict";

var cov_25r04gii2u = function () {
  var path = "C:\\Users\\Eneojo\\Desktop\\Branches\\develop\\server\\middleware\\validate.js",
      hash = "f86d3c7b8d62b7410a1a3dcd0e100fcc87d08315",
      Function = function () {}.constructor,
      global = new Function('return this')(),
      gcv = "__coverage__",
      coverageData = {
    path: "C:\\Users\\Eneojo\\Desktop\\Branches\\develop\\server\\middleware\\validate.js",
    statementMap: {
      "0": {
        start: {
          line: 7,
          column: 28
        },
        end: {
          line: 14,
          column: 5
        }
      },
      "1": {
        start: {
          line: 16,
          column: 22
        },
        end: {
          line: 16,
          column: 66
        }
      },
      "2": {
        start: {
          line: 17,
          column: 4
        },
        end: {
          line: 19,
          column: 5
        }
      },
      "3": {
        start: {
          line: 18,
          column: 6
        },
        end: {
          line: 18,
          column: 63
        }
      },
      "4": {
        start: {
          line: 21,
          column: 4
        },
        end: {
          line: 21,
          column: 18
        }
      },
      "5": {
        start: {
          line: 25,
          column: 29
        },
        end: {
          line: 29,
          column: 5
        }
      },
      "6": {
        start: {
          line: 31,
          column: 22
        },
        end: {
          line: 31,
          column: 67
        }
      },
      "7": {
        start: {
          line: 32,
          column: 4
        },
        end: {
          line: 34,
          column: 5
        }
      },
      "8": {
        start: {
          line: 33,
          column: 6
        },
        end: {
          line: 33,
          column: 63
        }
      },
      "9": {
        start: {
          line: 36,
          column: 4
        },
        end: {
          line: 36,
          column: 18
        }
      },
      "10": {
        start: {
          line: 40,
          column: 21
        },
        end: {
          line: 40,
          column: 61
        }
      },
      "11": {
        start: {
          line: 41,
          column: 4
        },
        end: {
          line: 51,
          column: 5
        }
      },
      "12": {
        start: {
          line: 43,
          column: 23
        },
        end: {
          line: 43,
          column: 67
        }
      },
      "13": {
        start: {
          line: 44,
          column: 8
        },
        end: {
          line: 46,
          column: 10
        }
      },
      "14": {
        start: {
          line: 45,
          column: 8
        },
        end: {
          line: 45,
          column: 120
        }
      },
      "15": {
        start: {
          line: 47,
          column: 6
        },
        end: {
          line: 47,
          column: 13
        }
      },
      "16": {
        start: {
          line: 50,
          column: 6
        },
        end: {
          line: 50,
          column: 34
        }
      },
      "17": {
        start: {
          line: 56,
          column: 30
        },
        end: {
          line: 63,
          column: 5
        }
      },
      "18": {
        start: {
          line: 65,
          column: 22
        },
        end: {
          line: 65,
          column: 68
        }
      },
      "19": {
        start: {
          line: 66,
          column: 4
        },
        end: {
          line: 68,
          column: 5
        }
      },
      "20": {
        start: {
          line: 67,
          column: 6
        },
        end: {
          line: 67,
          column: 63
        }
      },
      "21": {
        start: {
          line: 70,
          column: 4
        },
        end: {
          line: 70,
          column: 18
        }
      },
      "22": {
        start: {
          line: 74,
          column: 6
        },
        end: {
          line: 76,
          column: 7
        }
      },
      "23": {
        start: {
          line: 75,
          column: 8
        },
        end: {
          line: 75,
          column: 96
        }
      },
      "24": {
        start: {
          line: 78,
          column: 6
        },
        end: {
          line: 78,
          column: 20
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 6,
            column: 2
          },
          end: {
            line: 6,
            column: 3
          }
        },
        loc: {
          start: {
            line: 6,
            column: 44
          },
          end: {
            line: 22,
            column: 3
          }
        },
        line: 6
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 24,
            column: 2
          },
          end: {
            line: 24,
            column: 3
          }
        },
        loc: {
          start: {
            line: 24,
            column: 39
          },
          end: {
            line: 37,
            column: 3
          }
        },
        line: 24
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 39,
            column: 2
          },
          end: {
            line: 39,
            column: 3
          }
        },
        loc: {
          start: {
            line: 39,
            column: 49
          },
          end: {
            line: 53,
            column: 3
          }
        },
        line: 39
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 55,
            column: 2
          },
          end: {
            line: 55,
            column: 3
          }
        },
        loc: {
          start: {
            line: 55,
            column: 46
          },
          end: {
            line: 71,
            column: 3
          }
        },
        line: 55
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 73,
            column: 2
          },
          end: {
            line: 73,
            column: 3
          }
        },
        loc: {
          start: {
            line: 73,
            column: 41
          },
          end: {
            line: 79,
            column: 3
          }
        },
        line: 73
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 17,
            column: 4
          },
          end: {
            line: 19,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 17,
            column: 4
          },
          end: {
            line: 19,
            column: 5
          }
        }, {
          start: {
            line: 17,
            column: 4
          },
          end: {
            line: 19,
            column: 5
          }
        }],
        line: 17
      },
      "1": {
        loc: {
          start: {
            line: 32,
            column: 4
          },
          end: {
            line: 34,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 32,
            column: 4
          },
          end: {
            line: 34,
            column: 5
          }
        }, {
          start: {
            line: 32,
            column: 4
          },
          end: {
            line: 34,
            column: 5
          }
        }],
        line: 32
      },
      "2": {
        loc: {
          start: {
            line: 44,
            column: 8
          },
          end: {
            line: 46,
            column: 10
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 44,
            column: 8
          },
          end: {
            line: 46,
            column: 10
          }
        }, {
          start: {
            line: 44,
            column: 8
          },
          end: {
            line: 46,
            column: 10
          }
        }],
        line: 44
      },
      "3": {
        loc: {
          start: {
            line: 66,
            column: 4
          },
          end: {
            line: 68,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 66,
            column: 4
          },
          end: {
            line: 68,
            column: 5
          }
        }, {
          start: {
            line: 66,
            column: 4
          },
          end: {
            line: 68,
            column: 5
          }
        }],
        line: 66
      },
      "4": {
        loc: {
          start: {
            line: 74,
            column: 6
          },
          end: {
            line: 76,
            column: 7
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 74,
            column: 6
          },
          end: {
            line: 76,
            column: 7
          }
        }, {
          start: {
            line: 74,
            column: 6
          },
          end: {
            line: 76,
            column: 7
          }
        }],
        line: 74
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0]
    },
    _coverageSchema: "43e27e138ebf9cfc5966b082cf9a028302ed4184"
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _validatorjs = _interopRequireDefault(require("validatorjs"));

var _index = _interopRequireDefault(require("../db/index"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var UserValidator =
/*#__PURE__*/
function () {
  function UserValidator() {
    _classCallCheck(this, UserValidator);
  }

  _createClass(UserValidator, null, [{
    key: "createUser",
    value: function createUser(request, response, next) {
      cov_25r04gii2u.f[0]++;
      var CreateUserRules = (cov_25r04gii2u.s[0]++, {
        firstname: 'required|string',
        lastname: 'required|string',
        othernames: 'required|string',
        email: 'required|email',
        phone: 'required',
        password: 'required'
      });
      var validator = (cov_25r04gii2u.s[1]++, new _validatorjs.default(request.body, CreateUserRules));
      cov_25r04gii2u.s[2]++;

      if (validator.fails()) {
        cov_25r04gii2u.b[0][0]++;
        cov_25r04gii2u.s[3]++;
        return response.status(415).json(validator.errors.all());
      } else {
        cov_25r04gii2u.b[0][1]++;
      }

      cov_25r04gii2u.s[4]++;
      return next();
    }
  }, {
    key: "login",
    value: function login(request, response, next) {
      cov_25r04gii2u.f[1]++;
      var CreateLoginRules = (cov_25r04gii2u.s[5]++, {
        email: 'required|email',
        password: 'required'
      });
      var validator = (cov_25r04gii2u.s[6]++, new _validatorjs.default(request.body, CreateLoginRules));
      cov_25r04gii2u.s[7]++;

      if (validator.fails()) {
        cov_25r04gii2u.b[1][0]++;
        cov_25r04gii2u.s[8]++;
        return response.status(415).json(validator.errors.all());
      } else {
        cov_25r04gii2u.b[1][1]++;
      }

      cov_25r04gii2u.s[9]++;
      return next();
    }
  }, {
    key: "adminOnly",
    value: function () {
      var _adminOnly = _asyncToGenerator(
      /*#__PURE__*/
      regeneratorRuntime.mark(function _callee(request, response, next) {
        var sqlQuery, _ref, rows;

        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                cov_25r04gii2u.f[2]++;
                sqlQuery = (cov_25r04gii2u.s[10]++, "SELECT is_admin FROM users WHERE id=$1");
                cov_25r04gii2u.s[11]++;
                _context.prev = 3;
                cov_25r04gii2u.s[12]++;
                _context.next = 7;
                return _index.default.query(sqlQuery, [request.user.id]);

              case 7:
                _ref = _context.sent;
                rows = _ref.rows;
                cov_25r04gii2u.s[13]++;

                if (!(rows[0].is_admin === false)) {
                  _context.next = 16;
                  break;
                }

                cov_25r04gii2u.b[2][0]++;
                cov_25r04gii2u.s[14]++;
                return _context.abrupt("return", response.status(401).json({
                  'Status': 401,
                  'message': 'You do not have permission to access this route!'
                }));

              case 16:
                cov_25r04gii2u.b[2][1]++;

              case 17:
                cov_25r04gii2u.s[15]++;
                next();
                _context.next = 25;
                break;

              case 21:
                _context.prev = 21;
                _context.t0 = _context["catch"](3);
                cov_25r04gii2u.s[16]++;
                return _context.abrupt("return", response.send(_context.t0));

              case 25:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[3, 21]]);
      }));

      return function adminOnly(_x, _x2, _x3) {
        return _adminOnly.apply(this, arguments);
      };
    }()
  }, {
    key: "createParcel",
    value: function createParcel(request, response, next) {
      cov_25r04gii2u.f[3]++;
      var CreateParcelRules = (cov_25r04gii2u.s[17]++, {
        receiver_number: 'required|string',
        weight: 'required|numeric',
        weight_metric: 'required|string',
        sender_address: 'required|string',
        receiver_address: 'required|string',
        current_location: 'required|string'
      });
      var validator = (cov_25r04gii2u.s[18]++, new _validatorjs.default(request.body, CreateParcelRules));
      cov_25r04gii2u.s[19]++;

      if (validator.fails()) {
        cov_25r04gii2u.b[3][0]++;
        cov_25r04gii2u.s[20]++;
        return response.status(415).json(validator.errors.all());
      } else {
        cov_25r04gii2u.b[3][1]++;
      }

      cov_25r04gii2u.s[21]++;
      return next();
    }
  }, {
    key: "getById",
    value: function getById(request, response, next) {
      cov_25r04gii2u.f[4]++;
      cov_25r04gii2u.s[22]++;

      if (!Number(request.params.id)) {
        cov_25r04gii2u.b[4][0]++;
        cov_25r04gii2u.s[23]++;
        return response.status(400).json({
          'Status': 400,
          'ERROR Message': 'id must be a number'
        });
      } else {
        cov_25r04gii2u.b[4][1]++;
      }

      cov_25r04gii2u.s[24]++;
      return next();
    }
  }]);

  return UserValidator;
}();

var _default = UserValidator;
exports.default = _default;